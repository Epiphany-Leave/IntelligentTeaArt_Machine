## 张大头步进电机

#### <u>*相关参数*</u>

### 1. `down_flag`

- **作用**: 这是一个标志位，用于控制脉冲的上升沿和下降沿。
- **使用**: 在脉冲生成中，如果 `down_flag` 为 1，则意味着下一周期会生成一个下降沿，否则生成上升沿。这与步进电机的驱动脉冲信号相关。

### 2. `finish_flag`

- **作用**: 用于标记电机是否已达到目标位置。
- **使用**: 当电机运动到目标位置后，将 `finish_flag` 置 1，表示当前动作已经完成。在程序逻辑中用来判断是否需要执行下一步操作。

### 3. `location_target`

- **作用**: 目标位置（以脉冲数量为单位）。
- **使用**: 这是步进电机最终要移动到的位置。在 `motor_opera()` 函数中，设置不同的目标位置来控制电机移动。

### 4. `location_now`

- **作用**: 当前位置（以脉冲数量为单位）。
- **使用**: 每当电机接收到脉冲，`location_now` 会更新以反映电机的当前位置。用于与 `location_target` 比较来判断电机是否到达目标。

### 5. `target_last`

- **作用**: 上一次的目标位置。
- **使用**: 记录电机的上一次目标位置。可能在程序中用于回溯或调整当前目标。

### 6. `target_temp`

- **作用**: 临时目标位置。
- **使用**: 在电机移动过程中，可能需要逐步调整目标位置，这个参数保存临时的目标值，直到最终达到 `location_target`。

### 7. `difference_value`

- **作用**: 当前目标位置与当前位置的差值。
- **使用**: 计算电机还需要移动的距离。通常用来控制电机的速度和判断何时减速或停止。

### 8. `difference_middle`

- **作用**: 用于表示到达目标的中间位置，可能用于加减速。
- **使用**: 这个参数可能与加减速算法相关，在电机到达目标位置的过程中，经过中间点时可能会调整速度。

### 9. `speed`

- **作用**: 电机的当前速度。
- **使用**: 控制电机以恒定速度移动，或根据加减速曲线调整速度。该值与定时器的重装载寄存器（ARR）直接相关。

### 10. `speed_en`

- **作用**: 速度控制使能位。
- **使用**: 当 `speed_en` 为 1 时，允许加减速控制；为 0 时，电机以固定速度运行。

### 11. `ARR_fast`

- **作用**: 电机快速运行时的定时器重装载值（对应高速度）。
- **使用**: 这个值设置定时器的周期长度，用于控制电机的脉冲频率。值越小，电机的速度越快。

### 12. `ARR_slow`

- **作用**: 电机慢速运行时的定时器重装载值（对应低速度）。
- **使用**: 类似于 `ARR_fast`，但用于慢速移动时。

### 13. `ARR_now`

- **作用**: 当前电机运行时的定时器重装载值。
- **使用**: 实时更新的定时器重装载值，用于动态调整电机的速度。

### 14. `speed_fast`

- **作用**: 电机快速运行时的实际速度值（通过 `ARR_fast` 计算得到）。
- **使用**: 该值由 `ARR_fast` 转换而来，用于表示电机在快速模式下的实际速度（脉冲频率）。

### 15. `speed_slow`

- **作用**: 电机慢速运行时的实际速度值（通过 `ARR_slow` 计算得到）。
- **使用**: 同样通过 `ARR_slow` 转换而来，用于表示电机在慢速模式下的实际速度。

### 16. `speed_now`

- **作用**: 电机当前的实际速度值（通过 `ARR_now` 计算得到）。
- **使用**: 根据当前的 `ARR_now` 计算电机的实际速度，用于实时显示或记录电机的速度状态。

### 17. `acceler`

- **作用**: 电机加速度值。
- **使用**: 用于控制电机的加减速过程，影响电机速度的变化率。越大表示电机加速越快。

### 18. `acceler_num`

- **作用**: 加速或减速的步数（加速阶段的脉冲数量）。
- **使用**: 控制加减速过程中，电机需要加速或减速多少步。这通常用于生成平滑的速度曲线。

#### <u>*控制方法*</u>

#### 1. 目标位置控制

通过设置 `location_target` 来控制步进电机移动到指定位置。程序会计算当前位置 `location_now` 和目标位置的差值 `difference_value`，从而判断电机是否需要继续移动或者停止。

#### 2. 速度控制

通过 `ARR_fast`, `ARR_slow`, 和 `ARR_now` 来动态调整电机的速度，配合 `acceler` 实现加减速控制。在移动过程中，可以根据电机离目标位置的远近逐渐减速。

#### 3. 加减速控制

加减速的实现依赖于 `speed_en` 使能标志位。如果启用了加减速控制，程序会根据 `acceler` 和 `acceler_num` 来逐步调整 `ARR_now`，从而实现电机平滑的加速和减速。

#### 4. 完成标志 `finish_flag`

在每次电机移动完成后，程序会设置 `finish_flag`，表示当前动作已完成，电机停止运行。这通常与下一步操作相联系。